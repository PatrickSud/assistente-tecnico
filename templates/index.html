<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Assistente de Atualização</title>
    <link
      rel="icon"
      type="image/x-icon"
      href="{{ url_for('static', filename='Icone/app_icon.ico') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body>
    <div class="background-shapes">
      <div class="shape shape-1"></div>
      <div class="shape shape-2"></div>
      <div class="shape shape-3"></div>
    </div>

    <div class="container">
      <header>
        <div class="logo-area">
          <i class="fa-solid fa-robot"></i>
          <h1>Assistente de Atualização</h1>
        </div>
        <p class="subtitle" id="app-subtitle">Agente de Comunicação</p>
      </header>


      <main id="wizard">
        <!-- Step 0: Application Selection -->
        <div class="step active" id="step-selection">
          <div class="card">
            <button class="btn-exit-top" onclick="exitApp()" title="Finalizar Assistente">
              <i class="fa-solid fa-xmark"></i>
            </button>
            <h2>Selecione a Aplicação</h2>
            <p>Escolha qual aplicação você deseja atualizar:</p>
            
            <div class="app-selection-grid">
              <button class="app-card" onclick="selectApp('agente')">
                <div class="app-icon">
                  <i class="fa-solid fa-arrow-up"></i>
                </div>
                <h3>Agente de Comunicação</h3>
              </button>
              
              <button class="app-card" onclick="selectApp('dominio')">
                <div class="app-icon">
                  <i class="fa-solid fa-calculator"></i>
                </div>
                <h3>Domínio Sistemas</h3>
              </button>
              
              <button class="app-card" onclick="selectApp('buscanfe')">
                <div class="app-icon">
                  <i class="fa-solid fa-file-invoice"></i>
                </div>
                <h3>Busca NF-e</h3>
              </button>
            </div>
          </div>
        </div>

        <!-- Step 1: Preparation -->
        <div class="step" id="step-welcome">
          <div class="card">
            <button class="btn-back" onclick="goBack()" title="Voltar">
              <i class="fa-solid fa-arrow-left"></i>
            </button>
            <button class="btn-exit-top" onclick="exitApp()" title="Finalizar Assistente">
              <i class="fa-solid fa-xmark"></i>
            </button>
            <div class="icon-container">
              <i class="fa-solid fa-power-off"></i>
            </div>
            <h2 id="prep-title">Preparação</h2>
            <p id="prep-description">
              Vamos preparar o ambiente para a atualização. Isso <b>finalizará</b>
              os processos do Agente de Comunicação.
            </p>

            <!-- Opções de Operação (Apenas para Domínio Sistemas) -->
            <div id="operation-type-container" style="display: none; margin-bottom: 20px; text-align: left;">
              <div class="radio-group">
                <label class="radio-label">
                  <input type="radio" name="operationType" value="update" checked onchange="toggleOperationMode()">
                  <span class="radio-custom"></span>
                  Atualização
                </label>
                <label class="radio-label">
                  <input type="radio" name="operationType" value="install" onchange="toggleOperationMode()">
                  <span class="radio-custom"></span>
                  Instalação
                </label>
              </div>
            </div>

            <button class="btn-primary" id="btn-start-process" onclick="startProcess()">
              Iniciar Processo <i class="fa-solid fa-arrow-right"></i>
            </button>
            
            <div id="dominio-install-area" style="display: none;">
                <button class="btn-primary" id="btn-download-dominio" onclick="startDominioDownload()">
                  Baixar mais recente <span id="dominio-version-display"></span> <i class="fa-solid fa-download"></i>
                </button>
                
                <div style="margin-top: 20px; border-top: 1px solid var(--border-color); padding-top: 15px;">
                    <p style="margin-bottom: 10px; font-size: 0.9rem;">Ou informe uma versão específica:</p>
                    <div class="input-group" style="margin-bottom: 10px;">
                        <input type="text" id="dominioVersionInput" placeholder="Ex: 105a10" autocomplete="off">
                    </div>
                    <button class="btn-secondary" onclick="startDominioCustomDownload()" style="width: 100%;">
                        Baixar essa versão
                    </button>
                </div>
            </div>
          </div>
        </div>



        <!-- Step 2: Version Input -->
        <div class="step" id="step-version">
          <div class="card">
            <button class="btn-back" onclick="goBack()" title="Voltar">
              <i class="fa-solid fa-arrow-left"></i>
            </button>
            <button class="btn-exit-top" onclick="exitApp()" title="Finalizar Assistente">
              <i class="fa-solid fa-xmark"></i>
            </button>
            <div class="icon-container">
              <i class="fa-solid fa-code-branch"></i>
            </div>
            <h2>Versão do Agente</h2>
            <p>Informe a versão que deseja instalar (Ex: <b>15.71</b>).</p>
            <div class="input-group">
              <input
                type="text"
                id="versionInput"
                placeholder="XX.XX"
                autocomplete="off"
              />
              <span class="input-highlight"></span>
            </div>
            <div class="actions">
              <button class="btn-secondary" onclick="runExistingInstaller()">
                Executar
              </button>
              <button class="btn-primary" onclick="confirmVersion()">
                Baixar <i class="fa-solid fa-download"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Step 3: Downloading -->
        <div class="step" id="step-download">
          <div class="card">
            <button class="btn-back" onclick="goBack()" title="Voltar">
              <i class="fa-solid fa-arrow-left"></i>
            </button>
            <button class="btn-exit-top" onclick="exitApp()" title="Finalizar Assistente">
              <i class="fa-solid fa-xmark"></i>
            </button>
            <div class="icon-container pulse">
              <i class="fa-solid fa-cloud-arrow-down"></i>
            </div>
            <h2>Baixando</h2>
            <p id="download-status-text">Iniciando download...</p>

            <div class="progress-container">
              <div class="progress-bar" id="progressBar"></div>
            </div>
            <p class="progress-details">
              <span id="dl-size">0.00</span> MB baixados
            </p>
          </div>
        </div>

        <!-- Step 4: Install -->
        <div class="step" id="step-install">
          <div class="card">
            <button class="btn-back" onclick="goBack()" title="Voltar">
              <i class="fa-solid fa-arrow-left"></i>
            </button>
            <button class="btn-exit-top" onclick="exitApp()" title="Finalizar Assistente">
              <i class="fa-solid fa-xmark"></i>
            </button>
            <div class="icon-container">
              <i class="fa-solid fa-compact-disc"></i>
            </div>
            <h2>Instalação</h2>
            <div id="manual-install-ui">
              <p><b>Clique</b> no botão abaixo para iniciar o instalador.</p>
              <button class="btn-primary" onclick="runInstaller()">
                Abrir Instalador <i class="fa-solid fa-external-link-alt"></i>
              </button>
            </div>
            <div class="taskbar-example">
              <p class="example-label">
                <i class="fa-solid fa-arrow-down"></i> 
                Exemplo: Procure o instalador na barra de tarefas
              </p>
              <img 
                src="{{ url_for('static', filename='taskbar-example.jpg') }}" 
                alt="Exemplo da barra de tarefas do Windows"
                class="taskbar-image"
              />
            </div>

            <ol class="instruction-list" style="margin-top: 15px">
              <li>Clique no ícone do instalador na barra de tarefas.</li>
              <li>Clique em "<b>Avançar</b>" até "<b>Finalizar</b>".</li>
              <li>Ao concluir a instalação, <b>clique no botão abaixo</b>.</li>
            </ol>
            <div
              id="install-check-area"
              style="display: none; margin-top: 20px"
            >
              <p><u>Já concluiu a instalação?</u></p>
              <button class="btn-success" onclick="verifyInstallation()">
                Sim, iniciar Agente de Comunicação
                <i class="fa-solid fa-check"></i>
              </button>
            </div>

            <div
              id="dominio-finish-area"
              style="display: none; margin-top: 20px"
            >
              <button class="btn-success" onclick="exitApp()">
                Finalizar
                <i class="fa-solid fa-check"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Step 5: Success -->
        <div class="step" id="step-success">
          <div class="card success-card">
            <button class="btn-back" onclick="goBack()" title="Voltar">
              <i class="fa-solid fa-arrow-left"></i>
            </button>
            <button class="btn-exit-top" onclick="exitApp()" title="Finalizar Assistente">
              <i class="fa-solid fa-xmark"></i>
            </button>
            <div class="icon-container success-icon">
              <i class="fa-solid fa-check-circle"></i>
            </div>
            <h2>Sucesso!</h2>
            <p>O Agente de Comunicação foi <b>iniciado</b>, verifique se o mesmo foi atualizado corretamente.</p>
            <div class="taskbar-example">
              <p class="example-label">
                <i class="fa-solid fa-arrow-down"></i> 
                Exemplo: Procure o Agente aqui
              </p>
              <img 
                src="{{ url_for('static', filename='agent-taskbar-example.jpg') }}" 
                alt="Exemplo do Agente na barra de tarefas do Windows"
                class="taskbar-image"
              />
            </div>
            <div class="actions">
              <button class="btn-primary" onclick="location.reload()">
                Voltar
              </button>
              <button class="btn-danger" onclick="exitApp()">
                Sair <i class="fa-solid fa-sign-out-alt"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Error State -->
        <div class="step" id="step-error">
          <div class="card error-card">
            <button class="btn-back" onclick="goBack()" title="Voltar">
              <i class="fa-solid fa-arrow-left"></i>
            </button>
            <button class="btn-exit-top" onclick="exitApp()" title="Finalizar Assistente">
              <i class="fa-solid fa-xmark"></i>
            </button>
            <div class="icon-container error-icon">
              <i class="fa-solid fa-times-circle"></i>
            </div>
            <h2>Ocorreu um Erro</h2>
            <p id="error-message">Detalhes do erro aqui.</p>
            <button class="btn-secondary" onclick="location.reload()">
              Tentar Novamente
            </button>
          </div>
        </div>
      </main>

      <footer>
        <p>Desenvolvido por Patrick Godoy</p>
      </footer>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
  </body>
</html>
